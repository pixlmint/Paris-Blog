<IfModule mod_rewrite.c>
    RewriteEngine On

    RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$

    RewriteRule ^(.*) - [E=BASE:%1]

    # RewriteRule ^(db.json|.vscode|.git)(/|$) index.html
    # Enable URL rewriting
    RewriteCond %{REQUEST_FILENAME} -s [OR]
    RewriteCond %{REQUEST_FILENAME} -l [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^.*$ - [NC,L]

    # Rewrite all other queries to the front controller.
    RewriteRule .? %{ENV:BASE}/index.php [L]
</IfModule>

<FilesMatch "\.(ico|jpg|jpeg|gif|png|pdf|mp3|mp4|html|css|js)$">
    Header set Cache-Control "public, max-age=31536000, no-transform"
</FilesMatch>

# Prevent file browsing
Options -Indexes -MultiViews